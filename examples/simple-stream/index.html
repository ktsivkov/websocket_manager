<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Chat Example</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
</head>
<body>
<div class="container p-5">
    <div class="row">
        <div class="col-md-8">
            <div class="input-group mb-3">
                <span class="input-group-text" id="username-label">@</span>
                <input type="text" id="username" class="form-control" placeholder="Username" aria-label="Username"
                       aria-describedby="username-label">
            </div>
        </div>
        <div class="col-md-4">
            <div class="d-grid">
                <button id="btn-connect" type="button" class="btn btn-success" onclick="connect()">Connect</button>
                <button id="btn-disconnect" type="button" class="btn btn-danger d-none" onclick="disconnect()">Disconnect</button>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div id="messages" class="list-group"></div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-4">
            <select id="target" class="form-select form-select" aria-label="Large select example">
                <option selected value="">Everyone</option>
                <option value="1">One</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
            </select>
        </div>
        <div class="col-md-8">
            <div class="input-group mb-3">
                <input type="text" id="message" class="form-control" placeholder="Type your message"
                       aria-label="Type your message" aria-describedby="message-label">
                <button id="btn-send" type="button" class="btn btn-primary">Send</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
<script>
    function connectedMessage(username) {
        const element = document.createElement("div");
        element.classList.add("alert","alert-success");
        element.setAttribute("role","alert");
        element.innerText = `${username} joined the chat.`;
        return element;
    }
    function disconnectedMessage(username) {
        const element = document.createElement("div");
        element.classList.add("alert","alert-warning");
        element.setAttribute("role","alert");
        element.innerText = `${username} left the chat.`;
        return element;
    }

    function connect() {
        const username = document.getElementById("username").value;
        if (!username || username.trim() === "") {
            alert("Please enter a username.");
            return
        }
        window.ws = new WebSocket(`ws://localhost:8080/ws?username=${username}`);
        window.ws.onopen = function () {
            document.getElementById("btn-connect").classList.add("d-none");
            document.getElementById("btn-disconnect").classList.remove("d-none");
            document.getElementById("btn-send").removeAttribute("disabled");
            document.getElementById("username").setAttribute("disabled", "disabled");
            document.getElementById("messages").appendChild(connectedMessage(username));
        }
        window.ws.onmessage = function (event) {
            event.data = JSON.parse(event.data);

            console.log(event);
        }
        window.ws.onerror = function (event) {
            console.log("Error:", event);
        }
        window.ws.onclose = function (event) {
            console.log("Close:", event);
            const username = document.getElementById("username").value;
            document.getElementById("btn-connect").classList.remove("d-none");
            document.getElementById("btn-disconnect").classList.add("d-none");
            document.getElementById("btn-send").setAttribute("disabled", "disabled");
            document.getElementById("username").removeAttribute("disabled");
            document.getElementById("messages").appendChild(disconnectedMessage(username));
        }
    }

    function sendMessage() {
        if (!window.ws) {
            return
        }

        window.ws.send(JSON.stringify({
            "to": document.getElementById("target").value,
            "message": document.getElementById("message").value
        }))
    }

    function disconnect() {
        window.ws.close();
    }
</script>
</body>
</html>